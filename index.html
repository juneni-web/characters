<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>æ±‰å­—é…å¯¹ Â· å¤šå…³å¡æŒ‘æˆ˜</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(to bottom, #fefcea, #f1da36);
      text-align: center;
      margin: 0;
    }
    h1 {
      color: #d35400;
      padding-top: 20px;
    }
    #game-board {
      display: grid;
      grid-template-columns: repeat(4, 70px);
      grid-gap: 10px;
      justify-content: center;
      margin: 20px auto;
    }
    .tile {
      width: 70px;
      height: 70px;
      background-color: #fff5e1;
      border: 2px solid #f39c12;
      font-size: 20px;
      line-height: 20px;
      cursor: pointer;
      border-radius: 8px;
      transition: background 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 5px;
    }
    .tile:hover {
      background-color: #f9e79f;
    }
    #progress, #level, #timer, #score {
      margin: 10px;
      font-size: 18px;
      color: #7d6608;
    }
    #victory-message {
      font-size: 22px;
      color: green;
      margin-top: 20px;
    }
    #restart-button {
      margin-top: 15px;
      display: none;
      font-size: 16px;
      background-color: #d35400;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
    }
    #teaching-tip {
      margin-top: 20px;
      font-size: 16px;
      color: #6e2c00;
    }
  </style>
</head>
<body>
  <h1>æ±‰å­—é…å¯¹ Â· å¤šå…³å¡æŒ‘æˆ˜</h1>
  <div id="level">å½“å‰å…³å¡ï¼šç¬¬ 1 å…³</div>
  <div id="timer">å€’è®¡æ—¶ï¼š60 ç§’</div>
  <div id="progress">ä»»åŠ¡è¿›åº¦ï¼š0 / 8</div>
  <div id="score">å¾—åˆ†ï¼š0</div>
  <div id="game-board"></div>
  <div id="victory-message"></div>
  <button id="restart-button" onclick="restartGame()">å†ç©ä¸€æ¬¡</button>
  <div id="teaching-tip">ğŸ’¡ æ•™å­¦å»ºè®®ï¼šè¯·å¤§å£°æœ—è¯»æ¯ä¸ªæ±‰å­—åŠæ‹¼éŸ³ï¼Œé…å¯¹æˆåŠŸåè¯•ç€ç”¨å®ƒé€ å¥ï¼</div>

  <script>
    const hanziList = [
      { char: "éº»", pinyin: "mÃ¡" }, { char: "çƒ¦", pinyin: "fÃ¡n" }, { char: "å®¢", pinyin: "kÃ¨" },
      { char: "æ°”", pinyin: "qÃ¬" }, { char: "è£…", pinyin: "zhuÄng" }, { char: "æ‚", pinyin: "zÃ¡" },
      { char: "å¿—", pinyin: "zhÃ¬" }, { char: "ç»æµ", pinyin: "jÄ«ng jÃ¬" }, { char: "è¯¾æœ¬", pinyin: "kÃ¨ bÄ›n" },
      { char: "å¸®å¿™", pinyin: "bÄng mÃ¡ng" }, { char: "æ—…é¦†", pinyin: "lÇš guÇn" }, { char: "ç›¸ä¿¡", pinyin: "xiÄng xÃ¬n" },
      { char: "æ°´å¹³", pinyin: "shuÇ pÃ­ng" }, { char: "è¾›è‹¦", pinyin: "xÄ«n kÇ”" }, { char: "æ–¹é¢", pinyin: "fÄng miÃ n" }
    ];

    let level = 1;
    let matchGoal = 8;
    let progress = 0;
    let score = 0;
    let selectedTile = null;
    let countdown;
    const gameBoard = document.getElementById("game-board");
    const progressText = document.getElementById("progress");
    const scoreText = document.getElementById("score");
    const victoryMessage = document.getElementById("victory-message");
    const restartButton = document.getElementById("restart-button");
    const levelText = document.getElementById("level");
    const timerText = document.getElementById("timer");

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function createBoard() {
      const chosen = [];
      while (chosen.length < matchGoal) {
        const h = hanziList[Math.floor(Math.random() * hanziList.length)];
        if (!chosen.some(e => e.char === h.char)) {
          chosen.push(h);
        }
      }
      const fullSet = [...chosen, ...chosen];
      shuffle(fullSet);

      gameBoard.innerHTML = "";
      fullSet.forEach(({ char, pinyin }) => {
        const tile = document.createElement("div");
        tile.className = "tile";
        tile.dataset.char = char;
        if (level === 1) {
          tile.innerHTML = `<div>${pinyin}</div><div style='font-size:24px;'>${char}</div>`;
        } else {
          tile.innerHTML = `<div style='font-size:24px;'>${char}</div>`;
        }
        tile.addEventListener("click", () => handleClick(tile));
        gameBoard.appendChild(tile);
      });
    }

    function handleClick(tile) {
      if (tile.classList.contains("matched") || tile === selectedTile) return;

      tile.style.backgroundColor = "#f6ddcc";

      if (!selectedTile) {
        selectedTile = tile;
      } else {
        if (tile.dataset.char === selectedTile.dataset.char) {
          tile.classList.add("matched");
          selectedTile.classList.add("matched");
          tile.style.backgroundColor = "#a9dfbf";
          selectedTile.style.backgroundColor = "#a9dfbf";
          progress++;
          score += 10;  // Increase score with each match
          progressText.textContent = `ä»»åŠ¡è¿›åº¦ï¼š${progress} / ${matchGoal}`;
          scoreText.textContent = `å¾—åˆ†ï¼š${score}`;

          if (progress < matchGoal) {
            victoryMessage.textContent = `ä½ ç¦»èƒœåˆ©è¿˜æœ‰ ${matchGoal - progress} æ­¥ï¼åŠ æ²¹ï¼`;
          } else {
            clearInterval(countdown);
            victoryMessage.innerHTML = `ğŸ‰ <b>ç¬¬ ${level} å…³å®Œæˆï¼</b><br>ğŸ† å¥–åŠ±ï¼š+100é‡‘å¸ +1ç»éªŒå€¼ï¼`;
            restartButton.style.display = "inline-block";
          }
        } else {
          setTimeout(() => {
            tile.style.backgroundColor = "";
            selectedTile.style.backgroundColor = "";
          }, 500);
        }
        selectedTile = null;
      }
    }

    function restartGame() {
      level++;
      matchGoal += 2;
      progress = 0;
      selectedTile = null;
      score = 0;
      levelText.textContent = `å½“å‰å…³å¡ï¼šç¬¬ ${level} å…³`;
      progressText.textContent = `ä»»åŠ¡è¿›åº¦ï¼š0 / ${matchGoal}`;
      scoreText.textContent = `å¾—åˆ†ï¼š${score}`;
      victoryMessage.textContent = "";
      restartButton.style.display = "none";
      startTimer();
      createBoard();
    }

    function startTimer() {
      let timeLeft = 60;
      timerText.textContent = `å€’è®¡æ—¶ï¼š${timeLeft} ç§’`;
      clearInterval(countdown);
      countdown = setInterval(() => {
        timeLeft--;
        timerText.textContent = `å€’è®¡æ—¶ï¼š${timeLeft} ç§’`;
        if (timeLeft <= 0) {
          clearInterval(countdown);
          victoryMessage.innerHTML = "â° æ—¶é—´åˆ°ï¼è¯·ç‚¹å‡»â€œå†ç©ä¸€æ¬¡â€é‡è¯•æœ¬å…³ã€‚";
          restartButton.style.display = "inline-block";
        }
      }, 1000);
    }

    window.onload = () => {
      createBoard();
      startTimer();
    };
  </script>
</body>
</html>
